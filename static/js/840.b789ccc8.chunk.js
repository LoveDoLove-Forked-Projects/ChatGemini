"use strict";(self.webpackChunkchatgemini=self.webpackChunkchatgemini||[]).push([[840],{3040:(e,t,n)=>{n.d(t,{k:()=>s});const s=async e=>{const t=navigator.clipboard||{writeText:e=>{const t=document.createElement("input");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)}};return!!t&&(t.writeText(e),!0)}},3840:(e,t,n)=>{n.r(t),n.d(t,{default:()=>q});var s=n(3424),a=n(328),l=n(1604),r=n(3556),i=n(4092),c=n(3760),o=(n(8408),n(8012)),d=n(3040),u=n(7803);const m=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,n=Date.now();return function(){if(Date.now()-n>=t){for(var s=arguments.length,a=new Array(s),l=0;l<s;l++)a[l]=arguments[l];e.apply(null,a),n=Date.now()}}};var p=n(9584),g=n(1984);const h=function(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;return function(){for(var s=arguments.length,a=new Array(s),l=0;l<s;l++)a[l]=arguments[l];clearTimeout(t),t=setTimeout((()=>{e.apply(this,a)}),n)}};var x=n(964),f=n.n(x),y=n(7884);const b=e=>{const{className:t,typingEffect:n,children:s}=e,[x,b]=(0,p.useState)({result:"",position:null}),v=m((async(e,t)=>{const n=await(0,d.k)(e),s=t.innerText;t.innerText=n?"\u590d\u5236\u6210\u529f":"\u590d\u5236\u5931\u8d25",setTimeout((()=>{t.innerText=s}),1e3)}),1200),j=h((async(e,t,n)=>{const s=n.innerText;try{n.innerText="\u6b63\u5728\u6267\u884c",n.disabled=!0,b({result:"# \u6b63\u5728\u52a0\u8f7d\u8d44\u6e90",position:e});const s=await(0,g.m)({indexURL:"".concat(window.location.pathname,"pyodide/"),stdout:t=>b({result:"# stdout\n".concat(t),position:e}),stderr:t=>b({result:"# stderr\n".concat(t),position:e})});await s.runPythonAsync("\nfrom js import prompt\ndef input(p):\n    return prompt(p)\n__builtins__.input = input\n"),b({result:"# \u6b63\u5728\u6267\u884c\u4ee3\u7801",position:e}),await s.runPythonAsync(t)}catch(a){b({result:"# \u6267\u884c\u5931\u8d25\n".concat(a),position:e})}n.innerText=s,n.disabled=!1}),300);return(0,p.useEffect)((()=>{b({result:"",position:null})}),[s]),(0,y.jsx)(a.I,{className:"prose text-sm lg:prose-base max-w-[100%] break-words ".concat(null!==t&&void 0!==t?t:""),children:s,components:{a:e=>{let{node:t,...n}=e;return(0,y.jsx)("a",{href:n.href,target:"_blank",rel:"noreferrer",...n,children:n.children})},pre:e=>{let{node:t,...n}=e;return(0,y.jsx)("pre",{className:"bg-transparent p-2",...n})},code:e=>{var t;let{className:s,children:a,node:l}=e;const r=/language-(\w+)/.exec(null!==s&&void 0!==s?s:""),i=null!==r?r[1]:"",c=(a?String(a):"\u275a").replace(n,"\u275a"),d=null!==(t=null===l||void 0===l?void 0:l.position)&&void 0!==t?t:null;return r?(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(o.c,{PreTag:"div",style:u.c,language:i,children:c.replace(/\n$/,"")}),(0,y.jsxs)("div",{className:"flex gap-2",children:[(0,y.jsx)("button",{className:"text-gray-700/100 text-xs hover:opacity-50",onClick:e=>{let{currentTarget:t}=e;return v(c,t)},children:"\u590d\u5236\u4ee3\u7801"}),!c.includes("\u275a")&&"python"===i&&(0,y.jsx)("button",{className:"text-gray-700/100 text-xs hover:opacity-50",onClick:e=>{let{currentTarget:t}=e;return j(d,c,t)},children:"\u6267\u884c\u4ee3\u7801"})]}),f()(x.position,d)&&!!x.result.length&&(0,y.jsx)(o.c,{PreTag:"div",style:u.c,language:"python",children:x.result.replace(/\n$/,"")})]}):(0,y.jsx)("code",{className:"text-gray-700",children:c.replace(/\n$/,"")})},table:e=>{let{node:t,...n}=e;return(0,y.jsx)("table",{className:"overflow-x-auto block whitespace-nowrap",...n})}},urlTransform:e=>e,rehypePlugins:[r.c,c.c],remarkPlugins:[l.c,i.c]})};const v=n.p+"static/media/wand-magic-sparkles-solid.b85c9c00c06c7ce7f5afa005c270a4e2.svg";const j=n.p+"static/media/user-regular.29db6a1f607a24b769df338cded3a768.svg";const w=n.p+"static/media/pen-to-square-solid.323a05100783991ea833e21daa2c0798.svg";const N=n.p+"static/media/trash-solid.65e8f8fd4029e1db2f655e77aab432af.svg";const k=n.p+"static/media/arrows-rotate-solid.814c55263931133090f94e8a0e4d3c9b.svg";const C=n.p+"static/media/clipboard-regular.087182556a42a3609963076f55a76062.svg";var T=n(3996),D=n(2816);let E=function(e){return e.Model="model",e.User="user",e}({}),z=function(e){return e[e.Edit=0]="Edit",e[e.Done=1]="Done",e[e.Cancel=2]="Cancel",e}({});const I=e=>{const{index:t,prompt:n,postscript:s,editState:a,role:l,children:r,onEdit:i,onDelete:c,onRefresh:o}=e,u=(0,p.useRef)(null);return(0,y.jsxs)("div",{className:"p-5 mb-3 mr-3 space-y-3 rounded-lg hover:bg-gray-100 transition-all",children:[(0,y.jsxs)("div",{className:"flex items-center",children:[(0,y.jsxs)("div",{className:"size-6 rounded-full flex justify-center items-center ".concat(l===E.Model?"bg-purple-600":"bg-lime-700"),children:[(0,y.jsx)("img",{className:l===E.Model?"size-3":"hidden",src:v,alt:""}),(0,y.jsx)("img",{className:l===E.User?"size-3":"hidden",src:j,alt:""})]}),(0,y.jsx)("span",{className:"ml-2 font-semibold text-gray-800/100",children:l===E.Model?"AI":"\u60a8"})]}),(0,y.jsx)("div",{className:"px-7",children:a.state===z.Edit&&t===a.index?(0,y.jsxs)("div",{className:"flex flex-col space-y-2 lg:text-base text-sm",children:[(0,y.jsx)("textarea",{className:"bg-transparent text-gray-800 rounded-lg p-2 overflow-y-scroll resize-none !outline-none",placeholder:"\u8bf7\u8f93\u5165\u5185\u5bb9...",defaultValue:n,ref:u,onInput:e=>{let{currentTarget:t}=e;return(0,T.S)(t,60,200)}}),(0,y.jsxs)("div",{className:"flex gap-2 justify-center",children:[(0,y.jsx)("button",{className:"px-3 py-2 border font-medium rounded-lg text-white bg-emerald-600 hover:bg-emerald-700",onClick:()=>{const{current:e}=u,{value:s}=e;i(t,z.Done,s!==n?s:"")},children:"\u50a8\u5b58\u5e76\u63d0\u4ea4"}),(0,y.jsx)("button",{className:"px-3 py-2 border font-medium rounded-lg hover:bg-gray-300",onClick:()=>i(t,z.Cancel,""),children:"\u53d6\u6d88"})]})]}):(0,y.jsx)(y.Fragment,{children:r})}),(0,y.jsxs)("div",{className:"flex ml-6 gap-1",children:[(0,y.jsx)("button",{className:"size-6 rounded-lg hover:bg-gray-200 flex justify-center items-center",onClick:async()=>{let e=r.props.children;s&&(e=e.replace(s,""));await(0,d.k)(e)?(0,D.I)("\u5185\u5bb9\u5df2\u590d\u5236\u5230\u526a\u8d34\u677f"):(0,D.I)("\u5185\u5bb9\u590d\u5236\u5931\u8d25",!0)},children:(0,y.jsx)("img",{src:C,className:"size-4",alt:""})}),l===E.User&&a.state!==z.Edit&&(0,y.jsx)("button",{className:"size-6 rounded-lg hover:bg-gray-200 flex justify-center items-center",onClick:()=>i(t,z.Edit,""),children:(0,y.jsx)("img",{src:w,className:"size-4",alt:""})}),l===E.Model&&(0,y.jsx)("button",{className:"size-6 rounded-lg hover:bg-gray-200 flex justify-center items-center",onClick:()=>o(t),children:(0,y.jsx)("img",{src:k,className:"size-4",alt:""})}),l===E.Model&&1!==t&&(0,y.jsx)("button",{className:"size-6 rounded-lg hover:bg-gray-200 flex justify-center items-center",onClick:()=>c(t),children:(0,y.jsx)("img",{src:N,className:"size-4",alt:""})})]})]})};var A=n(3948),S=n(708),W=n(9224),M=n(3544),R=n(3440),U=n(3420),P=n(8572),_=n(4916);var O=n(6137);n(6588);const F=e=>{const{delegate:t,options:n,children:s}=e;return(0,p.useEffect)((()=>(O.gx.bind(null!==t&&void 0!==t?t:"[data-image-view]",n),()=>O.gx.destroy())),[t,n]),(0,y.jsx)(y.Fragment,{children:s})};var L=n(6848);const $="\u91cd\u65b0\u751f\u6210\u4e2d...",q=e=>{var t,n;const a=null!==(t=null===(n=e.refs)||void 0===n?void 0:n.mainSectionRef.current)&&void 0!==t?t:null,{site:l}=U.globalConfig.title,r=(0,A.OY)(),i=(0,A.w1)((e=>e.sessions.sessions)),c=(0,A.w1)((e=>e.ai.ai)),{id:o}=(0,s.W4)(),[d,u]=(0,p.useState)([]),[m,g]=(0,p.useState)({index:0,state:z.Cancel}),[h,x]=(0,p.useState)({}),f=(0,p.useCallback)((function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(c.busy||e)&&(null===a||void 0===a||a.scrollTo({top:a.scrollHeight,behavior:"smooth"}))}),[c,a]),v=async(e,t)=>{const n=null!==t&&void 0!==t?t:i;if(!c.busy&&o&&o in n){var s;let t={...n,[o]:[...n[o].slice(0,e),{role:"model",parts:$,timestamp:Date.now()}]};r((0,S.Wy)({...c,busy:!0})),r((0,W.Wy)(t));const a=(n,s)=>{s&&r((0,S.Wy)({...c,busy:!1}));const a=t[o][e].parts!==$?t[o][e].parts:"",l=Date.now();t={...t,[o]:[...t[o].slice(0,e),{role:"model",parts:"".concat(a).concat(n),timestamp:l}]},u(t[o]),r((0,W.Wy)(t))};null!==(s=t[o][e-1].attachment)&&void 0!==s&&s.data.length?await(0,_.g)(c.model.vision,t[o][e-1].parts,t[o][e-1].attachment,U.globalConfig.sse,a):await(0,M.W)(c.model.pro,t[o].slice(0,e-1),t[o][e-1].parts,U.globalConfig.sse,R.W,a)}else c.busy&&(0,D.I)("AI \u6b63\u5fd9\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5",!0)},j=(e,t,n)=>{if(c.busy||g({index:e,state:t}),!c.busy&&o&&o in i&&n.length&&t===z.Done){const t={...i,[o]:[...i[o].slice(0,e),{...i[o][e],parts:n},{role:"model",parts:$,timestamp:Date.now()}]};u(t[o]),v(e+1,t)}else c.busy&&(0,D.I)("AI \u6b63\u5fd9\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5",!0)},w=e=>{!c.busy&&o&&o in i?(0,L.O)("\u8fd9\u5219\u56de\u5e94\u548c\u5bf9\u5e94\u63d0\u95ee\u90fd\u5c06\u88ab\u79fb\u9664\uff0c\u8981\u7ee7\u7eed\u5417\uff1f",(()=>{const t={...i,[o]:[...i[o].slice(0,e-1),...i[o].slice(e+1)]};r((0,W.Wy)(t)),u(t[o])})):c.busy&&(0,D.I)("AI \u6b63\u5fd9\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5",!0)};return(0,p.useEffect)((()=>{if(o&&o in i){var e;u(i[o]);let t=null!==(e=i[o][0].title)&&void 0!==e?e:i[o][0].parts;t.length>20&&(t="".concat(t.substring(0,20)," ...")),document.title="".concat(t," | ").concat(l)}else document.title="\u4f1a\u8bdd\u65e0\u6548 | ".concat(l),u([{role:"model",parts:"\u60a8\u5f53\u524d\u7684\u4f1a\u8bdd ID \u4f3c\u4e4e\u65e0\u6548\uff0c\u8bf7\u68c0\u67e5\u60a8\u7684\u7f51\u5740\uff0c\u60a8\u4e5f\u53ef\u4ee5\u65b0\u5efa\u4e00\u4e2a\u4f1a\u8bdd\u3002",timestamp:0}]);setTimeout((()=>f(!0)),300)}),[l,o,i,a,f]),(0,y.jsx)(P.q,{className:"max-w-[calc(100%)] py-5 pl-3 mb-auto mx-1 md:mx-[4rem] lg:mx-[8rem]",children:(0,y.jsx)(F,{children:d.map(((e,t)=>{let{role:n,parts:s,attachment:a,timestamp:l}=e;const{mimeType:r,data:i}=null!==a&&void 0!==a?a:{mimeType:"",data:""};let o="";i.length&&l in h?o=h[l]:i.length&&(o=(e=>{try{let t="image/png";if(e.indexOf("data:image")>=0){let n=e.split(",");t=n[0].match(/:(.*?);/)[1]||"image/png",e=n[1]}let n=window.atob(e),s=new ArrayBuffer(n.length),a=new Uint8Array(s);for(let e=0;e<n.length;e++)a[e]=n.charCodeAt(e);let l=new Blob([s],{type:t});return URL.createObjectURL(l)}catch(t){return""}})("data:".concat(r,";base64,").concat(i)),x((e=>({...e,[l]:o}))));const u='\n\n---\n\n<div class="inline-block text-center overflow-hidden">\n                        <a data-image-view="gallery" href="'.concat(o,'">\n                            <img src="').concat(o,'" style="\n                                max-width: 10rem;\n                                margin-top: 0;\n                                margin-bottom: 0.2rem;\n                                border-radius: 0.25rem;\n                            " alt="\u56fe\u7247\u9644\u4ef6" />\n                        </a>\n                        <span class="text-xs text-gray-400">\n                            \u70b9\u51fb\u67e5\u770b\u5927\u56fe\n                        </span>\n                    </div>'),p='<div class="inline px-1 bg-gray-900 animate-pulse animate-duration-700"></div>';return c.busy&&n===E.Model&&t===d.length-1&&(s+=p),(0,y.jsx)(I,{index:t,prompt:s,editState:m,role:n,onRefresh:v,onDelete:w,onEdit:j,postscript:i.length?u:"",children:(0,y.jsx)(b,{typingEffect:p,children:"".concat(s).concat(i.length?u:"")})},t)}))})})}}}]);