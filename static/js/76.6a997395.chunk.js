"use strict";(self.webpackChunkchatgemini=self.webpackChunkchatgemini||[]).push([[76],{7704:(e,t,a)=>{a.d(t,{A:()=>n});const n=async e=>{const t=navigator.clipboard||{writeText:e=>{const t=document.createElement("input");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)}};return!!t&&(t.writeText(e),!0)}},2076:(e,t,a)=>{a.r(t),a.d(t,{default:()=>q});var n=a(3424),s=a(328),l=a(1604),r=a(3556),c=a(4092),o=a(3760),i=(a(8408),a(8012)),d=a(7704),u=a(7803);const m=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,a=Date.now();return function(){if(Date.now()-a>=t){for(var n=arguments.length,s=new Array(n),l=0;l<n;l++)s[l]=arguments[l];e.apply(null,s),a=Date.now()}}};var p=a(9584);const g=function(e){let t,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;return function(){for(var n=arguments.length,s=new Array(n),l=0;l<n;l++)s[l]=arguments[l];clearTimeout(t),t=setTimeout((()=>{e.apply(this,s)}),a)}},y=(e,t)=>Object.keys(e).length===Object.keys(t).length&&Object.keys(e).every((a=>Object.prototype.hasOwnProperty.call(t,a)&&e[a]===t[a]));var h=a(1984);var x=a(7884);const f="\n\ud83d\ude08 [Info] \u7ed3\u679c\u9700\u4ee5 print \u8f93\u51fa\n\ud83d\ude80 [Info] \u5c1d\u8bd5\u6267\u884c Python \u811a\u672c...\n",v=e=>{const{className:t,typingEffect:a,children:n}=e,[v,b]=(0,p.useState)(null),[w,k]=(0,p.useState)({result:"",startPos:null,endPos:null}),j=m((async(e,t)=>{const a=await(0,d.A)(e),n=t.innerText;t.innerText=a?"\u590d\u5236\u6210\u529f":"\u590d\u5236\u5931\u8d25",setTimeout((()=>{t.innerText=n}),1e3)}),1200),N=e=>k((t=>({...t,result:"".concat(t.result.replace(f,""),"\n").concat(e)}))),C=g((async(e,t,a,n)=>{let s;var l,r,c;v?s=v:(l="".concat(window.location.pathname,"pyodide/"),r=N,c=N,s=(0,h.m)({indexURL:l,stdout:r,stderr:c,homedir:"/home/user"}),b(s)),n.disabled=!0,k({result:"$ python3 script.py".concat(f),startPos:e,endPos:t}),await(async(e,t,a)=>{const n=[{keyword:"numpy",package:"numpy"},{keyword:"pydantic",package:"pydantic"},{keyword:"pydecimal",package:"decimal"},{keyword:"asciitree",package:"asciitree"},{keyword:"dateutil",package:"python-dateutil"},{keyword:"yaml",package:"pyyaml"},{keyword:"docutils",package:"docutils"},{keyword:"jsonschema",package:"jsonschema"},{keyword:"pytz",package:"pytz"},{keyword:"lxml",package:"lxml"},{keyword:"cryptography",package:"cryptography"},{keyword:"Crypto",package:"pycryptodome"},{keyword:"nacl",package:"pynacl"},{keyword:"regex",package:"regex"},{keyword:"hashlib",package:"hashlib"}];try{const a=n.filter((e=>{let{keyword:a}=e;return t.includes("import ".concat(a))||t.includes("from ".concat(a))})).map((e=>{let{package:t}=e;return t}));a.length&&await(await e).loadPackage(a),await(await e).runPythonAsync("\nfrom js import prompt\ndef input(p):\n    return prompt(p)\n__builtins__.input = input\n"),await(await e).runPythonAsync(t)}catch(s){a("".concat(s))}})(s,a,N),n.disabled=!1}),300);return(0,p.useEffect)((()=>{k({result:"",startPos:null,endPos:null})}),[n]),(0,x.jsx)(s.I,{className:"prose text-sm lg:prose-base max-w-[100%] break-words ".concat(null!==t&&void 0!==t?t:""),children:n,components:{a:e=>{let{node:t,...a}=e;return(0,x.jsx)("a",{href:a.href,target:"_blank",rel:"noreferrer",...a,children:a.children})},pre:e=>{let{node:t,...a}=e;return(0,x.jsx)("pre",{className:"bg-transparent p-2",...a})},code:e=>{var t,n,s,l,r,c;let{className:o,children:d,node:m}=e;const p=/language-(\w+)/.exec(null!==o&&void 0!==o?o:""),g=null!==p?p[1]:"",h=(d?String(d):"\u275a").replace(a,"\u275a"),f=null!==(t=null===m||void 0===m||null===(n=m.position)||void 0===n?void 0:n.start)&&void 0!==t?t:null,v=null!==(s=null===m||void 0===m||null===(l=m.position)||void 0===l?void 0:l.end)&&void 0!==s?s:null;return p?(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(i.c,{PreTag:"div",style:u.c,language:g,showLineNumbers:!0,lineNumberStyle:{opacity:.5},children:h.replace(/\n$/,"")}),(0,x.jsxs)("div",{className:"flex gap-2",children:[(0,x.jsx)("button",{className:"text-gray-700/100 text-xs hover:opacity-50",onClick:e=>{let{currentTarget:t}=e;return j(h,t)},children:"\u590d\u5236\u4ee3\u7801"}),!h.includes("\u275a")&&"python"===g&&(0,x.jsx)("button",{className:"text-gray-700/100 text-xs hover:opacity-50",onClick:e=>{let{currentTarget:t}=e;return C(f,v,h,t)},children:"\u6267\u884c\u4ee3\u7801"})]}),y(null!==(r=w.startPos)&&void 0!==r?r:{},null!==f&&void 0!==f?f:{})&&y(null!==(c=w.endPos)&&void 0!==c?c:{},null!==v&&void 0!==v?v:{})&&!!w.result.length&&(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(i.c,{language:"shell",PreTag:"div",style:u.c,children:w.result.replace(/\n$/,"")}),(0,x.jsxs)("div",{className:"flex gap-2",children:[(0,x.jsx)("button",{className:"text-gray-700/100 text-xs hover:opacity-50",onClick:e=>{let{currentTarget:t}=e;return j(w.result,t)},children:"\u590d\u5236\u7ed3\u679c"}),(0,x.jsx)("button",{className:"text-gray-700/100 text-xs hover:opacity-50",onClick:()=>k({result:"",startPos:null,endPos:null}),children:"\u5173\u95ed\u7a97\u53e3"})]})]})]}):(0,x.jsx)("code",{className:"text-gray-700",children:h.replace(/\n$/,"")})},table:e=>{let{node:t,...a}=e;return(0,x.jsx)("table",{className:"overflow-x-auto block whitespace-nowrap",...a})}},urlTransform:e=>e,rehypePlugins:[r.c,o.c],remarkPlugins:[l.c,c.c]})};const b=a.p+"static/media/wand-magic-sparkles-solid.b85c9c00c06c7ce7f5afa005c270a4e2.svg";const w=a.p+"static/media/user-regular.29db6a1f607a24b769df338cded3a768.svg";const k=a.p+"static/media/pen-to-square-solid.323a05100783991ea833e21daa2c0798.svg";const j=a.p+"static/media/trash-solid.65e8f8fd4029e1db2f655e77aab432af.svg";const N=a.p+"static/media/arrows-rotate-solid.814c55263931133090f94e8a0e4d3c9b.svg";const C=a.p+"static/media/clipboard-regular.087182556a42a3609963076f55a76062.svg";var P=a(3996),T=a(2816);let z=function(e){return e.Model="model",e.User="user",e}({}),A=function(e){return e[e.Edit=0]="Edit",e[e.Done=1]="Done",e[e.Cancel=2]="Cancel",e}({});const I=e=>{const{index:t,prompt:a,postscript:n,editState:s,role:l,children:r,onEdit:c,onDelete:o,onRefresh:i}=e,u=(0,p.useRef)(null);return(0,x.jsxs)("div",{className:"p-5 mb-3 mr-3 space-y-3 rounded-lg hover:bg-gray-100 transition-all",children:[(0,x.jsxs)("div",{className:"flex items-center",children:[(0,x.jsxs)("div",{className:"size-6 rounded-full flex justify-center items-center ".concat(l===z.Model?"bg-purple-600":"bg-lime-700"),children:[(0,x.jsx)("img",{className:l===z.Model?"size-3":"hidden",src:b,alt:""}),(0,x.jsx)("img",{className:l===z.User?"size-3":"hidden",src:w,alt:""})]}),(0,x.jsx)("span",{className:"ml-2 font-semibold text-gray-800/100",children:l===z.Model?"AI":"\u60a8"})]}),(0,x.jsx)("div",{className:"px-7",children:s.state===A.Edit&&t===s.index?(0,x.jsxs)("div",{className:"flex flex-col space-y-2 lg:text-base text-sm",children:[(0,x.jsx)("textarea",{className:"bg-transparent text-gray-800 rounded-lg p-2 overflow-y-scroll resize-none !outline-none",placeholder:"\u8bf7\u8f93\u5165\u5185\u5bb9...",defaultValue:a,ref:u,onInput:e=>{let{currentTarget:t}=e;return(0,P.S)(t,60,200)}}),(0,x.jsxs)("div",{className:"flex gap-2 justify-center",children:[(0,x.jsx)("button",{className:"px-3 py-2 border font-medium rounded-lg text-white bg-emerald-600 hover:bg-emerald-700",onClick:()=>{const{current:e}=u,{value:n}=e;c(t,A.Done,n!==a?n:"")},children:"\u50a8\u5b58\u5e76\u63d0\u4ea4"}),(0,x.jsx)("button",{className:"px-3 py-2 border font-medium rounded-lg hover:bg-gray-300",onClick:()=>c(t,A.Cancel,""),children:"\u53d6\u6d88"})]})]}):(0,x.jsx)(x.Fragment,{children:r})}),(0,x.jsxs)("div",{className:"flex ml-6 gap-1",children:[(0,x.jsx)("button",{className:"size-6 rounded-lg hover:bg-gray-200 flex justify-center items-center",onClick:async()=>{let e=r.props.children;n&&(e=e.replace(n,""));await(0,d.A)(e)?(0,T.I)("\u5185\u5bb9\u5df2\u590d\u5236\u5230\u526a\u8d34\u677f"):(0,T.I)("\u5185\u5bb9\u590d\u5236\u5931\u8d25",!0)},children:(0,x.jsx)("img",{src:C,className:"size-4",alt:""})}),l===z.User&&s.state!==A.Edit&&(0,x.jsx)("button",{className:"size-6 rounded-lg hover:bg-gray-200 flex justify-center items-center",onClick:()=>c(t,A.Edit,""),children:(0,x.jsx)("img",{src:k,className:"size-4",alt:""})}),l===z.Model&&(0,x.jsx)("button",{className:"size-6 rounded-lg hover:bg-gray-200 flex justify-center items-center",onClick:()=>i(t),children:(0,x.jsx)("img",{src:N,className:"size-4",alt:""})}),l===z.Model&&1!==t&&(0,x.jsx)("button",{className:"size-6 rounded-lg hover:bg-gray-200 flex justify-center items-center",onClick:()=>o(t),children:(0,x.jsx)("img",{src:j,className:"size-4",alt:""})})]})]})};var D=a(3948),E=a(708),S=a(9224),O=a(3544),W=a(3440),M=a(3420),R=a(8572),U=a(4916);var _=a(6137);a(6588);const F=e=>{const{delegate:t,options:a,children:n}=e;return(0,p.useEffect)((()=>(_.gx.bind(null!==t&&void 0!==t?t:"[data-image-view]",a),()=>_.gx.destroy())),[t,a]),(0,x.jsx)(x.Fragment,{children:n})};var L=a(6848);const $="\u91cd\u65b0\u751f\u6210\u4e2d...",q=e=>{var t,a;const s=null!==(t=null===(a=e.refs)||void 0===a?void 0:a.mainSectionRef.current)&&void 0!==t?t:null,{site:l}=M.globalConfig.title,r=(0,D.OY)(),c=(0,D.w1)((e=>e.sessions.sessions)),o=(0,D.w1)((e=>e.ai.ai)),{id:i}=(0,n.W4)(),[d,u]=(0,p.useState)([]),[m,g]=(0,p.useState)({index:0,state:A.Cancel}),[y,h]=(0,p.useState)({}),f=(0,p.useCallback)((function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(o.busy||e)&&(null===s||void 0===s||s.scrollTo({top:s.scrollHeight,behavior:"smooth"}))}),[o,s]),b=async(e,t)=>{const a=null!==t&&void 0!==t?t:c;if(!o.busy&&i&&i in a){var n;let t={...a,[i]:[...a[i].slice(0,e),{role:"model",parts:$,timestamp:Date.now()}]};r((0,E.Wy)({...o,busy:!0})),r((0,S.Wy)(t));const s=(a,n)=>{n&&r((0,E.Wy)({...o,busy:!1}));const s=t[i][e].parts!==$?t[i][e].parts:"",l=Date.now();t={...t,[i]:[...t[i].slice(0,e),{role:"model",parts:"".concat(s).concat(a),timestamp:l}]},u(t[i]),r((0,S.Wy)(t))};null!==(n=t[i][e-1].attachment)&&void 0!==n&&n.data.length?await(0,U.g)(o.model.vision,t[i][e-1].parts,t[i][e-1].attachment,M.globalConfig.sse,s):await(0,O.W)(o.model.pro,t[i].slice(0,e-1),t[i][e-1].parts,M.globalConfig.sse,W.W,s)}else o.busy&&(0,T.I)("AI \u6b63\u5fd9\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5",!0)},w=(e,t,a)=>{if(o.busy||g({index:e,state:t}),!o.busy&&i&&i in c&&a.length&&t===A.Done){const t={...c,[i]:[...c[i].slice(0,e),{...c[i][e],parts:a},{role:"model",parts:$,timestamp:Date.now()}]};u(t[i]),b(e+1,t)}else o.busy&&(0,T.I)("AI \u6b63\u5fd9\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5",!0)},k=e=>{!o.busy&&i&&i in c?(0,L.O)("\u8fd9\u5219\u56de\u5e94\u548c\u5bf9\u5e94\u63d0\u95ee\u90fd\u5c06\u88ab\u79fb\u9664\uff0c\u8981\u7ee7\u7eed\u5417\uff1f",(()=>{const t={...c,[i]:[...c[i].slice(0,e-1),...c[i].slice(e+1)]};r((0,S.Wy)(t)),u(t[i])})):o.busy&&(0,T.I)("AI \u6b63\u5fd9\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5",!0)};return(0,p.useEffect)((()=>{if(i&&i in c){var e;u(c[i]);let t=null!==(e=c[i][0].title)&&void 0!==e?e:c[i][0].parts;t.length>20&&(t="".concat(t.substring(0,20)," ...")),document.title="".concat(t," | ").concat(l)}else document.title="\u4f1a\u8bdd\u65e0\u6548 | ".concat(l),u([{role:"model",parts:"\u60a8\u5f53\u524d\u7684\u4f1a\u8bdd ID \u4f3c\u4e4e\u65e0\u6548\uff0c\u8bf7\u68c0\u67e5\u60a8\u7684\u7f51\u5740\uff0c\u60a8\u4e5f\u53ef\u4ee5\u65b0\u5efa\u4e00\u4e2a\u4f1a\u8bdd\u3002",timestamp:0}]);setTimeout((()=>f(!0)),300)}),[l,i,c,s,f]),(0,x.jsx)(R.q,{className:"max-w-[calc(100%)] py-5 pl-3 mb-auto mx-1 md:mx-[4rem] lg:mx-[8rem]",children:(0,x.jsx)(F,{children:d.map(((e,t)=>{let{role:a,parts:n,attachment:s,timestamp:l}=e;const{mimeType:r,data:c}=null!==s&&void 0!==s?s:{mimeType:"",data:""};let i="";c.length&&l in y?i=y[l]:c.length&&(i=(e=>{try{let t="image/png";if(e.indexOf("data:image")>=0){let a=e.split(",");t=a[0].match(/:(.*?);/)[1]||"image/png",e=a[1]}let a=window.atob(e),n=new ArrayBuffer(a.length),s=new Uint8Array(n);for(let e=0;e<a.length;e++)s[e]=a.charCodeAt(e);let l=new Blob([n],{type:t});return URL.createObjectURL(l)}catch(t){return""}})("data:".concat(r,";base64,").concat(c)),h((e=>({...e,[l]:i}))));const u='\n\n---\n\n<div class="inline-block text-center overflow-hidden">\n                        <a data-image-view="gallery" href="'.concat(i,'">\n                            <img src="').concat(i,'" style="\n                                max-width: 10rem;\n                                margin-top: 0;\n                                margin-bottom: 0.2rem;\n                                border-radius: 0.25rem;\n                            " alt="\u56fe\u7247\u9644\u4ef6" />\n                        </a>\n                        <span class="text-xs text-gray-400">\n                            \u70b9\u51fb\u67e5\u770b\u5927\u56fe\n                        </span>\n                    </div>'),p='<div class="inline px-1 bg-gray-900 animate-pulse animate-duration-700"></div>';return o.busy&&a===z.Model&&t===d.length-1&&(n+=p),(0,x.jsx)(I,{index:t,prompt:n,editState:m,role:a,onRefresh:b,onDelete:k,onEdit:w,postscript:c.length?u:"",children:(0,x.jsx)(v,{typingEffect:p,children:"".concat(n).concat(c.length?u:"")})},t)}))})})}}}]);